<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Cytify">





<title>apue_1.unix基础知识 | Cytify</title>



    <link rel="icon" href="/0.jfif">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Cytify&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Cytify&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">apue_1.unix基础知识</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Cytify</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">January 31, 2021&nbsp;&nbsp;21:51:04</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/apue/">apue</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="1-Unix体系结构"><a href="#1-Unix体系结构" class="headerlink" title="1. Unix体系结构"></a>1. Unix体系结构</h2><p><strong>内核</strong>：控制硬件，提供程序运行环境。</p>
<p><strong>系统调用</strong>：内核的接口，公用函数库建立在系统调用之上</p>
<p><strong>shell</strong>：特殊的应用程序，为其他应用程序提供接口</p>
<img src="/2021/01/31/apue-1-unix%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20210124102409215.png" alt="image-20210124102409215" style="zoom:50%;">

<h2 id="2-登录"><a href="#2-登录" class="headerlink" title="2. 登录"></a>2. 登录</h2><h3 id="2-1-登录名"><a href="#2-1-登录名" class="headerlink" title="2.1 登录名"></a>2.1 登录名</h3><p>登录名信息在口令文件中（通常在/etc/passwd文件）查看。</p>
<p><img src="/2021/01/31/apue-1-unix%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/apue-1-unix%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%5C0.png" alt="0"></p>
<p>登录项又冒号隔开的7个字段组成，分别为：</p>
<ul>
<li>登录名</li>
<li>加密口令</li>
<li>数字用户ID</li>
<li>数字组ID</li>
<li>注释字段</li>
<li>起始目录</li>
<li><code>shell</code>程序，系统启动后运行的<code>shell</code>的路径</li>
</ul>
<h3 id="2-2-shell"><a href="#2-2-shell" class="headerlink" title="2.2 shell"></a>2.2 shell</h3><p><code>shell</code>即命令行解释器，读取输入，执行命令，可以从终端或者文件中获取输入。</p>
<p>根据用户项中的信息，启动对应的<code>shell</code>。</p>
<img src="/2021/01/31/apue-1-unix%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20210124103854383.png" alt="image-20210124103854383" style="zoom:67%;">

<h2 id="3-文件和目录"><a href="#3-文件和目录" class="headerlink" title="3. 文件和目录"></a>3. 文件和目录</h2><h3 id="3-1-文件名"><a href="#3-1-文件名" class="headerlink" title="3.1 文件名"></a>3.1 文件名</h3><p>文件名中不能出现左斜杠<code>/</code>和空格。左斜杠是路径名中的一部分，空格是用来终止路径名。</p>
<p>推荐使用字母、数字、句点、短横线和下划线。</p>
<p><strong>在创建新目录时，同时创建了两个文件名：点<code>.</code>和点点<code>..</code></strong></p>
<ul>
<li><code>.</code>点：指向当前目录</li>
<li><code>..</code>点点：指向父目录</li>
</ul>
<h3 id="3-2-路径名"><a href="#3-2-路径名" class="headerlink" title="3.2 路径名"></a>3.2 路径名</h3><p>以斜线开头的为绝对路径，否则为相对路径。</p>
<h3 id="3-3-工作目录"><a href="#3-3-工作目录" class="headerlink" title="3.3 工作目录"></a>3.3 工作目录</h3><p>每个进程都有个工作目录，所有相对路径前都会加上工作目录，进程可以使用<code>chdir</code>函数更改工作目录</p>
<h3 id="3-4-起始目录"><a href="#3-4-起始目录" class="headerlink" title="3.4 起始目录"></a>3.4 起始目录</h3><p>登陆后，工作目录设置为起始目录，起始目录在登录项中可以取地</p>
<h2 id="4-输入和输出"><a href="#4-输入和输出" class="headerlink" title="4. 输入和输出"></a>4. 输入和输出</h2><h3 id="4-1-文件描述符"><a href="#4-1-文件描述符" class="headerlink" title="4.1 文件描述符"></a>4.1 文件描述符</h3><p>文件描述符通常是一个小的非负整数，内核用以<strong>标识特定进程访问的文件</strong>。</p>
<h3 id="4-2-标准输入、标准输出、标准错误"><a href="#4-2-标准输入、标准输出、标准错误" class="headerlink" title="4.2 标准输入、标准输出、标准错误"></a>4.2 标准输入、标准输出、标准错误</h3><p>运行一个程序时，<code>shell</code>为其打开三个文件描述符，即标准输入、标准输出和标准错误。一般，这三个描述符都链接到终端。</p>
<p>可以通过重定向来使得三个描述符定向到某个文件</p>
<h3 id="4-3-不带缓冲的IO"><a href="#4-3-不带缓冲的IO" class="headerlink" title="4.3 不带缓冲的IO"></a>4.3 不带缓冲的IO</h3><p>函数<code>open</code>、<code>read</code>、<code>write</code>、<code>lseek</code>和<code>close</code>提供了不到缓冲的IO</p>
<h3 id="4-4-标准IO"><a href="#4-4-标准IO" class="headerlink" title="4.4 标准IO"></a>4.4 标准IO</h3><p>标准IO为不带缓冲的IO提供了一个带缓冲的接口。简化了对输入行的处理</p>
<h2 id="5-程序和进程"><a href="#5-程序和进程" class="headerlink" title="5. 程序和进程"></a>5. 程序和进程</h2><h3 id="5-1-程序"><a href="#5-1-程序" class="headerlink" title="5.1 程序"></a>5.1 程序</h3><p>程序是存储在磁盘某个目录上的可执行文件，内核使用<code>exec</code>函数，将程序读入内存，执行程序。</p>
<h3 id="5-2-进程"><a href="#5-2-进程" class="headerlink" title="5.2 进程"></a>5.2 进程</h3><p>程序的执行实例被称为进程，每个进程都有唯一的标识符，称为<strong>进程ID</strong>，总是一个非负整数。</p>
<h3 id="5-3-进程控制"><a href="#5-3-进程控制" class="headerlink" title="5.3 进程控制"></a>5.3 进程控制</h3><p>主要有三个函数进行进程控制：<code>fork</code>、<code>exec</code>和<code>waitpid</code></p>
<h3 id="5-4-线程和线程ID"><a href="#5-4-线程和线程ID" class="headerlink" title="5.4 线程和线程ID"></a>5.4 线程和线程ID</h3><p> 通常，一个进程只有一个线程——某一时刻执行的一组机器指令。但是可以通过额外设置线程来解决问题。</p>
<p>一个进程内的所有线程可以共享同一地址空间、文件描述符、栈以及进程属性。</p>
<p>线程也有线程ID，但是仅仅是对于该进程，对于另外的进程，该进程的线程ID没有意义。</p>
<h2 id="6-出错处理"><a href="#6-出错处理" class="headerlink" title="6. 出错处理"></a>6. 出错处理</h2><p>Unix系统函数出错时，通常返回一个负值，且整型变量<code>errno</code>设置为具有特定信息的值。</p>
<p><code>&lt;errno.h&gt;</code>中定义了<code>errno</code>及其常值。这些常值都以E开头。</p>
<p>POSIX和ISO C都将<code>errno</code>设置为一个可修改的整型左值。在多线程中，每个线程都有自己的局部<code>errno</code>，避免干扰，</p>
<p>在linux中，<code>errno</code>定义如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> *__errno_location(<span class="keyword">void</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> errno (*__errno_location());</span></span><br></pre></td></tr></table></figure>

<p><strong><code>errno</code>的使用注意以下两点</strong></p>
<ul>
<li>如果没有出错，<code>errno</code>的值不会被清除。因此只在出错时检测<code>errno</code>的值</li>
<li>任何函数都不会将<code>errno</code>的值设为0，且所有<code>errno</code>的常值也不为0</li>
</ul>
<p>C标准定义了两个函数用于打印出错信息</p>
<ul>
<li><pre><code class="c">#include &lt;string.h&gt;

char *strerror(int errnum);
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  &#96;strerror&#96;将&#96;errno&#96;值映射为一个字符串，并返回字符串指针</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;c</span><br><span class="line">  #include &lt;stdio.h&gt;</span><br><span class="line">  </span><br><span class="line">  void perror(const char *msg);	</span><br></pre></td></tr></table></figure>

`perror`函数基于`errno`的当前值，在标准错误输出一条出错信息，然后返回。

首先输出`msg`指向的信息，一个冒号一个空格，接着是`errno`对应的出错信息，最后是换行符。
</code></pre>
</li>
</ul>
<h3 id="6-1-出错恢复"><a href="#6-1-出错恢复" class="headerlink" title="6.1 出错恢复"></a>6.1 出错恢复</h3><p>错误有两类：<strong>致命性的和非致命性的</strong>。</p>
<ul>
<li>致命性错误无法恢复，输出一条出错信息后就退出</li>
<li>资源短缺相关的错误通常是非致命性的，常见的恢复方法有，隔段时间后重新访问</li>
</ul>
<h2 id="7-用户表示"><a href="#7-用户表示" class="headerlink" title="7. 用户表示"></a>7. 用户表示</h2><h3 id="7-1-用户ID"><a href="#7-1-用户ID" class="headerlink" title="7.1 用户ID"></a>7.1 用户ID</h3><p>用户ID是一个数值，唯一的标识每一个用户，且用户不可更改其用户ID。</p>
<h3 id="7-2-组ID"><a href="#7-2-组ID" class="headerlink" title="7.2 组ID"></a>7.2 组ID</h3><p>组ID是由系统管理员在用户登陆时分配的，多个用户可以有相同的组ID。组ID可以将用户划分为各个部门、项目中，可以设置权限，使得这一组的用户有权限访问文件。</p>
<p>组文件将组名映射到数值，文件路径通常为<code>/etc/group</code>。</p>
<h3 id="7-3-附属组ID"><a href="#7-3-附属组ID" class="headerlink" title="7.3 附属组ID"></a>7.3 附属组ID</h3><p>除了组ID为，用户还可以属于另外一些组。</p>
<h2 id="8-信号"><a href="#8-信号" class="headerlink" title="8. 信号"></a>8. 信号</h2><p>信号用于通知进程发生的情况，进程的信号处理的方式有三种：</p>
<ul>
<li>忽略。但是有些异常，如地址错误等，结果不确定，所以不推荐忽略信号</li>
<li>按照默认方法处理。如除0，系统默认终止进程</li>
<li>提供函数，信号发生时调用。</li>
</ul>
<p>键盘产生信号的方法有两种：</p>
<ul>
<li>中断键，中断当前运行进程，<code>ctrl+c</code></li>
<li>退出键，终端当前运行进程，<code>ctrl+/</code></li>
</ul>
<h2 id="9-时间值"><a href="#9-时间值" class="headerlink" title="9. 时间值"></a>9. 时间值</h2><p>有两种不同的时间值</p>
<ul>
<li>日历时间，从1970年1月1日00:00:00到现在经过的秒数。 <code>time_t</code>保存这种时间值</li>
<li>进程时间，度量进程使用CPU资源的时间。<code>clock_t</code>保存这种时间值</li>
</ul>
<p>在度量一个进程的执行时间时，<strong>系统为进程维护了3个时间</strong></p>
<ul>
<li><strong>时钟时间</strong>，又称为墙上时钟时间，是进程运行的时间总量，值与系统中同时运行的进程数有关。</li>
<li><strong>用户CPU时间</strong>，执行用户指令的时间。</li>
<li><strong>系统CPU时间</strong>，进程执行内核程序所经过的时间。</li>
</ul>
<h2 id="10-系统调用和库函数"><a href="#10-系统调用和库函数" class="headerlink" title="10. 系统调用和库函数"></a>10. 系统调用和库函数</h2><p>Unix中的每个系统调用在标准C库中设置了一个具有相同名字的函数。用户使用标准C库中的函数，函数使用系统要求的技术调用相应的内核服务。</p>
<p>系统调用和库函数的异同：</p>
<ul>
<li><p>系统调用和库函数都是以<strong>C函数</strong>的形式给出</p>
</li>
<li><p>系统调用通常不可以被替换，库函数是可以替换的</p>
</li>
</ul>
<p>如，可以使用<code>malloc</code>实现内存分配，但并不是唯一的方式，Unix系统中实现内存分配的系统调用为<code>sbrk</code>，用户也可以自定义<code>malloc</code>函数，不去调用库函数。</p>
<img src="/2021/01/31/apue-1-unix%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20210127190639073.png" alt="image-20210127190639073" style="zoom:50%;">


        </div>

        
            <section class="post-copyright">
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/unix/"># unix</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2021/01/31/apue-2-unix%E6%A0%87%E5%87%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/">apue_2.unix标准及实现</a>
            
            
            <a class="next" rel="next" href="/2020/11/30/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/">创建型模式-原型模式</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span></span>
    </div>
</footer>

    </div>
</body>
</html>
